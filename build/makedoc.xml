<?xml version="1.0" encoding="UTF-8"?>
<project name="PHPFrame" basedir="../" default="build">

    <property name="build.dir" value="${project.basedir}/build"/>
    <property name="report.dir" value="${build.dir}/report"/>
    <property name="doc.dir" value="${build.dir}/doc"/>
    <property name="tmp.dir" value="${build.dir}/tmp/doc"/>
    
    <!-- Prepare directories -->
    <target name="prepare">
        <delete dir="${doc.dir}" includeemptydirs="true" verbose="true" failonerror="true" />
        <mkdir dir="${doc.dir}"/>
        
        <delete dir="${tmp.dir}" includeemptydirs="true" verbose="true" failonerror="true" />
        <mkdir dir="${tmp.dir}"/>
    </target>
    
    <!-- copy files to tmp doc dir for parsing documentation -->
    <target name="copy">
        <!-- copy files -->
        <copy todir="${tmp.dir}" overwrite="true">
            <fileset dir="${build.dir}/tmp">
                <include name="examples/**" />
            	<include name="PHPFrame/**" />
            	<include name="PHPFrame.php" />
            	<include name="tutorials/**" />
            	<include name="CREDITS" />
            	<include name="LICENSE" />
            	<include name="README" />
            </fileset>
        </copy>
    	<!-- copy tutorials files -->
        <copy todir="${tmp.dir}" overwrite="true">
            <fileset dir="${project.basedir}">
                <include name="tutorials/**" />
            </fileset>
        </copy>
    </target>
    
    <!-- Generate API documentation from Javadoc comments using phpdoc -->
    <target name="apidoc">
        <exec 
            command="phpdoc \
                    -d ${tmp.dir} \
                    -t ${doc.dir} \
                    -ric README,LICENSE,CREDITS \
                    -i examples/ \
                    -s on \
                    -dn PHPFrame \
                    -o HTML:Smarty:PHP \
                    -ti 'PHPFrame API Documentation'" 
            dir="${project.basedir}" 
            output="${report.dir}/phpdoc.log" />
    </target>
    
    <target name="sync">
        <exec 
            command="rsync -vru -e 'ssh -p 2222' --delete \
                     ${doc.dir}/ \
                     phpframe@e-noise.com:~/doc/api/" 
            dir="${project.basedir}" 
            output="${report.dir}/rsync_doc.log" />
    </target>
    
    <target name="build" depends="prepare, copy, apidoc, sync" />
    
</project>
